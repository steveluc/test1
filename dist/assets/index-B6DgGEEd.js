(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function e(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=e(t);fetch(t.href,i)}})();let k=50,R=8,S=6,h=[],v=null,C=[],P=null,y=null,B=0,O=-1,m={mode:"simple",customRows:4,customCols:4};function z(o,r){y=o.cloneNode(!0),y.classList.add("drag-ghost"),y.style.width=o.offsetWidth+"px",y.style.height=o.offsetHeight+"px",y.style.left=r.clientX+"px",y.style.top=r.clientY+"px";const e=window.getComputedStyle(o).transform;e&&e!=="none"&&(y.style.transform=e+" translate(-50%, -50%)"),document.body.appendChild(y)}function A(o){y&&(y.style.left=o.clientX+"px",y.style.top=o.clientY+"px")}function G(){y&&(y.remove(),y=null)}function W(o){const e=window.innerHeight>window.innerWidth?o:q(o);h[e].rotation||(h[e].rotation=0),h[e].rotation=(h[e].rotation+90)%360,T()}function K(){const o=window.innerHeight>window.innerWidth,r=S,e=R;let n,t;o?(n=window.innerHeight-200,t=window.innerWidth-40):(n=window.innerHeight-30,t=window.innerWidth-320-40);const i=Math.floor((n-20)/e),c=Math.floor((t-20)/r);return Math.max(30,Math.min(i,c,100))}function L(){const o=Math.floor(Math.random()*360),r=60+Math.floor(Math.random()*30),e=60+Math.floor(Math.random()*20);return`hsl(${o}, ${r}%, ${e}%)`}function V(){const o=["solid","horizontal","vertical","diagonal","checkerboard","quartersquare"],r=o[Math.floor(Math.random()*o.length)];if(r==="solid")return{type:"solid",colors:[L()],rotation:0};if(r==="horizontal"||r==="vertical"||r==="diagonal"){const e=[];for(let n=0;n<5;n++)e.push(L());return{type:r,colors:e,rotation:0}}else{if(r==="checkerboard")return{type:"checkerboard",colors:[L(),L()],rotation:0};if(r==="quartersquare")return{type:"quartersquare",colors:[L(),L(),L(),L()],rotation:0}}return{type:"solid",colors:[L()],rotation:0}}function M(){h=[];const o=R*S;for(let r=0;r<o;r++)h.push(V())}function D(o){if(o.type==="solid")return o.colors[0];if(o.type==="horizontal"){const e=[];for(let n=0;n<5;n++){const t=n*20,i=(n+1)*20;e.push(`${o.colors[n]} ${t}%`),e.push(`${o.colors[n]} ${i}%`)}return`linear-gradient(to bottom, ${e.join(", ")})`}else if(o.type==="vertical"){const e=[];for(let n=0;n<5;n++){const t=n*20,i=(n+1)*20;e.push(`${o.colors[n]} ${t}%`),e.push(`${o.colors[n]} ${i}%`)}return`linear-gradient(to right, ${e.join(", ")})`}else if(o.type==="diagonal"){const e=[];for(let n=0;n<5;n++){const t=n*20,i=(n+1)*20;e.push(`${o.colors[n]} ${t}%`),e.push(`${o.colors[n]} ${i}%`)}return`linear-gradient(45deg, ${e.join(", ")})`}else if(o.type==="checkerboard"){const r=o.colors[0].replace("#","%23"),e=o.colors[1].replace("#","%23");let n="";for(let t=0;t<4;t++)for(let i=0;i<4;i++){const c=(t+i)%2===0?r:e;n+=`<rect x='${i*25}' y='${t*25}' width='25' height='25' fill='${c}'/>`}return`url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'>${n}</svg>")`}else if(o.type==="quartersquare"){const r=o.colors[0].replace("#","%23"),e=o.colors[1].replace("#","%23"),n=o.colors[2].replace("#","%23"),t=o.colors[3].replace("#","%23");return`url("data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><polygon points='0,0 100,0 50,50' fill='${r}'/><polygon points='100,0 100,100 50,50' fill='${e}'/><polygon points='100,100 0,100 50,50' fill='${n}'/><polygon points='0,100 0,0 50,50' fill='${t}'/></svg>")`}return""}function j(){const r=document.getElementById("designerPatternType").value,e=document.getElementById("colorStripePicker");e.innerHTML="";let n=1,t=["#ff6b9d"];r==="solid"?(n=1,t=["#ff6b9d"]):r==="horizontal"||r==="vertical"||r==="diagonal"?(n=5,t=["#ff6b9d","#764ba2","#667eea","#f093fb","#4facfe"]):r==="checkerboard"?(n=2,t=["#ff6b9d","#667eea"]):r==="quartersquare"&&(n=4,t=["#ff6b9d","#764ba2","#667eea","#f093fb"]);for(let i=0;i<n;i++){const c=document.createElement("input");c.type="color",c.value=t[i],e.appendChild(c)}}function Z(){const r=document.getElementById("designerPatternType").value,e=document.querySelectorAll('#colorStripePicker input[type="color"]'),n=Array.from(e).map(i=>i.value),t={type:r,colors:n,rotation:0};C.push(t),$()}function $(){const o=document.getElementById("libraryItems");if(o.innerHTML="",C.length===0){o.innerHTML='<p style="color: #999; font-style: italic;">No patterns yet. Design one above to get started!</p>';return}C.forEach((r,e)=>{const n=document.createElement("div");n.className="library-item",n.draggable=!0;const t=D(r);r.type==="solid"?(n.style.backgroundColor=t,n.style.backgroundImage="none"):(n.style.backgroundImage=t,n.style.backgroundColor="transparent",n.style.backgroundRepeat="no-repeat"),n.addEventListener("dragstart",()=>{P=e,n.classList.add("dragging")}),n.addEventListener("dragend",()=>{n.classList.remove("dragging"),P=null}),n.addEventListener("touchstart",c=>{P=e,v=null,n.classList.add("dragging"),z(n,c.touches[0]),c.stopPropagation()}),n.addEventListener("touchmove",c=>{c.preventDefault();const u=c.touches[0];A(u);const f=document.elementFromPoint(u.clientX,u.clientY);document.querySelectorAll(".quilt-square.drag-over").forEach(l=>{l.classList.remove("drag-over")}),f&&f.classList.contains("quilt-square")&&f.classList.add("drag-over")}),n.addEventListener("touchend",c=>{c.preventDefault(),n.classList.remove("dragging"),G();const u=c.changedTouches[0],f=document.elementFromPoint(u.clientX,u.clientY);if(document.querySelectorAll(".quilt-square.drag-over").forEach(l=>{l.classList.remove("drag-over")}),f&&f.classList.contains("quilt-square")){const l=document.getElementById("quilt"),s=Array.from(l.children).indexOf(f),b=window.innerHeight>window.innerWidth;if(s!==-1){const d=b?s:q(s);h[d]=JSON.parse(JSON.stringify(C[e]));const I=h[d],g=D(I),a=f;I.type==="solid"?(a.style.backgroundColor=g,a.style.backgroundImage="none"):(a.style.backgroundImage=g,a.style.backgroundColor="transparent",a.style.backgroundRepeat="no-repeat"),a.style.transform=`rotate(${I.rotation||0}deg)`}}P=null});const i=document.createElement("button");i.className="delete-btn",i.textContent="×",i.onclick=c=>{c.stopPropagation(),C.splice(e,1),$()},n.appendChild(i),o.appendChild(n)})}function _(){const o=S,r=R,e=100,n=document.createElement("canvas");n.width=o*e,n.height=r*e;const t=n.getContext("2d");for(let i=0;i<r*o;i++){const c=Math.floor(i/o),f=i%o*e,l=c*e,s=window.innerHeight>window.innerWidth,b=m.mode==="simple"&&!s?q(i):i,d=h[b],I=d.rotation||0;if(t.save(),I!==0?(t.translate(f+e/2,l+e/2),t.rotate(I*Math.PI/180),t.translate(-e/2,-e/2)):t.translate(f,l),d.type==="solid")t.fillStyle=d.colors[0],t.fillRect(0,0,e,e),t.restore();else if(d.type==="horizontal"){const g=e/5;for(let a=0;a<5;a++)t.fillStyle=d.colors[a],t.fillRect(0,a*g,e,g);t.restore()}else if(d.type==="vertical"){const g=e/5;for(let a=0;a<5;a++)t.fillStyle=d.colors[a],t.fillRect(a*g,0,g,e);t.restore()}else if(d.type==="diagonal"){t.beginPath(),t.rect(0,0,e,e),t.clip(),t.translate(e/2,e/2),t.rotate(-45*Math.PI/180);const g=e*Math.sqrt(2),a=g/5;for(let p=0;p<5;p++)t.fillStyle=d.colors[p],t.fillRect(-g/2+p*a,-g/2,a,g);t.restore()}else if(d.type==="checkerboard"){const g=e/4;for(let a=0;a<4;a++)for(let p=0;p<4;p++){const w=(a+p)%2;t.fillStyle=d.colors[w],t.fillRect(p*g,a*g,g,g)}t.restore()}else if(d.type==="quartersquare"){const g=e/2,a=e/2;t.fillStyle=d.colors[0],t.beginPath(),t.moveTo(0,0),t.lineTo(e,0),t.lineTo(g,a),t.closePath(),t.fill(),t.fillStyle=d.colors[1],t.beginPath(),t.moveTo(e,0),t.lineTo(e,e),t.lineTo(g,a),t.closePath(),t.fill(),t.fillStyle=d.colors[2],t.beginPath(),t.moveTo(e,e),t.lineTo(0,e),t.lineTo(g,a),t.closePath(),t.fill(),t.fillStyle=d.colors[3],t.beginPath(),t.moveTo(0,e),t.lineTo(0,0),t.lineTo(g,a),t.closePath(),t.fill(),t.restore()}}n.toBlob(i=>{if(i){const c=URL.createObjectURL(i),u=document.createElement("a");u.href=c,u.download=`quilt-${Date.now()}.png`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c)}})}function U(){const o={patterns:h,library:C,gridConfig:m,savedAt:new Date().toISOString()},r=JSON.stringify(o,null,2),e=new Blob([r],{type:"application/json"}),n=URL.createObjectURL(e),t=document.createElement("a");t.href=n,t.download=`quilt-design-${Date.now()}.json`,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(n)}function tt(o){var n;const r=(n=o.files)==null?void 0:n[0];if(!r)return;const e=new FileReader;e.onload=function(t){var i;try{const c=JSON.parse((i=t.target)==null?void 0:i.result);c.patterns&&c.patterns.length===48&&(h=c.patterns,T()),c.library&&(C=c.library,$()),c.gridConfig?(m=c.gridConfig,m.squaresPerSide&&!m.customRows&&(m.customRows=m.squaresPerSide,m.customCols=m.squaresPerSide),m.customRows||(m.customRows=4),m.customCols||(m.customCols=4)):m={mode:"simple",customRows:4,customCols:4},alert("Quilt loaded successfully!")}catch(c){alert("Error loading quilt: "+c.message)}o.value=""},e.readAsText(r)}function q(o){const r=Math.floor(o/8),n=o%8,t=5-r;return n*6+t}function et(){if(m.mode==="custom"){R=m.customRows||4,S=m.customCols||4;return}window.innerHeight>window.innerWidth?(R=8,S=6):(R=6,S=8)}function E(o,r){const e=D(r);r.type==="solid"?(o.style.backgroundColor=e,o.style.backgroundImage="none"):(o.style.backgroundImage=e,o.style.backgroundColor="transparent",o.style.backgroundRepeat="no-repeat"),o.style.transform=`rotate(${r.rotation||0}deg)`}function T(){const o=document.getElementById("quilt");o.innerHTML="",et(),o.style.gridTemplateColumns=`repeat(${S}, 1fr)`,k=K();const r=window.innerHeight>window.innerWidth,e=R*S;h.length!==e&&M();for(let n=0;n<R*S;n++){const t=document.createElement("div");t.className="quilt-square";let i=n;m.mode==="simple"&&!r&&(i=q(n));const c=h[i];E(t,c),t.style.width=`${k}px`,t.style.height=`${k}px`,t.draggable=!0,t.addEventListener("dragstart",u=>{if(v=n,t.classList.add("dragging"),u.dataTransfer){const f=document.createElement("canvas"),l=t.offsetWidth;f.width=l,f.height=l;const s=f.getContext("2d"),b=r?n:q(n),d=h[b],I=d.rotation||0;if(s.save(),s.translate(l/2,l/2),s.rotate(I*Math.PI/180),s.translate(-l/2,-l/2),d.type==="solid")s.fillStyle=d.colors[0],s.fillRect(0,0,l,l);else if(d.type==="horizontal"||d.type==="vertical"||d.type==="diagonal"){const a=l/5;for(let p=0;p<5;p++)if(s.fillStyle=d.colors[p],d.type==="horizontal")s.fillRect(0,p*a,l,a);else if(d.type==="vertical")s.fillRect(p*a,0,a,l);else if(d.type==="diagonal"){s.save(),s.translate(l/2,l/2),s.rotate(-45*Math.PI/180);const w=l*Math.sqrt(2),N=w/5;s.fillRect(-w/2+p*N,-w/2,N,w),s.restore()}}else if(d.type==="checkerboard"){const a=l/4;for(let p=0;p<4;p++)for(let w=0;w<4;w++)s.fillStyle=d.colors[(p+w)%2],s.fillRect(w*a,p*a,a,a)}else if(d.type==="quartersquare"){const a=l/2,p=l/2;s.fillStyle=d.colors[0],s.beginPath(),s.moveTo(0,0),s.lineTo(l,0),s.lineTo(a,p),s.closePath(),s.fill(),s.fillStyle=d.colors[1],s.beginPath(),s.moveTo(l,0),s.lineTo(l,l),s.lineTo(a,p),s.closePath(),s.fill(),s.fillStyle=d.colors[2],s.beginPath(),s.moveTo(l,l),s.lineTo(0,l),s.lineTo(a,p),s.closePath(),s.fill(),s.fillStyle=d.colors[3],s.beginPath(),s.moveTo(0,l),s.lineTo(0,0),s.lineTo(a,p),s.closePath(),s.fill()}s.restore();const g=new Image;g.src=f.toDataURL(),g.style.position="absolute",g.style.top="-9999px",document.body.appendChild(g),u.dataTransfer.setDragImage(g,l/2,l/2),setTimeout(()=>g.remove(),0)}}),t.addEventListener("dragend",u=>{t.classList.remove("dragging"),v=null}),t.addEventListener("dblclick",u=>{u.preventDefault(),W(n)}),t.addEventListener("dragover",u=>{u.preventDefault(),t.classList.add("drag-over")}),t.addEventListener("dragleave",u=>{t.classList.remove("drag-over")}),t.addEventListener("drop",u=>{u.preventDefault(),t.classList.remove("drag-over");const f=r?n:q(n);if(P!==null)h[f]=JSON.parse(JSON.stringify(C[P])),E(t,h[f]);else if(v!==null&&v!==n){const l=r?v:q(v);h[f]=JSON.parse(JSON.stringify(h[l])),E(t,h[f])}}),t.addEventListener("touchstart",u=>{const f=new Date().getTime(),l=f-B;if(l<300&&l>0&&O===n){u.preventDefault(),W(n),B=0,O=-1;return}B=f,O=n,v=n,t.classList.add("dragging"),z(t,u.touches[0]),u.preventDefault()}),t.addEventListener("touchmove",u=>{u.preventDefault();const f=u.touches[0];A(f);const l=document.elementFromPoint(f.clientX,f.clientY);document.querySelectorAll(".quilt-square.drag-over").forEach(s=>{s.classList.remove("drag-over")}),l&&l.classList.contains("quilt-square")&&l.classList.add("drag-over")}),t.addEventListener("touchend",u=>{u.preventDefault(),t.classList.remove("dragging"),G();const f=u.changedTouches[0],l=document.elementFromPoint(f.clientX,f.clientY);if(document.querySelectorAll(".quilt-square.drag-over").forEach(s=>{s.classList.remove("drag-over")}),l&&l.classList.contains("quilt-square")){const s=Array.from(o.children).indexOf(l);if(v!==null&&s!==-1&&v!==s){const b=r?s:q(s);if(P!==null)h[b]=JSON.parse(JSON.stringify(C[P]));else{const d=r?v:q(v);h[b]=JSON.parse(JSON.stringify(h[d]))}E(l,h[b])}}v=null,P=null}),o.appendChild(t)}}window.addEventListener("resize",T);window.addEventListener("orientationchange",T);function ot(){document.getElementById("gridSettingsModal").classList.add("active"),document.querySelectorAll('input[name="gridMode"]').forEach(e=>{e.checked=e.value===m.mode}),Q(),F(),X(),H()}function J(){document.getElementById("gridSettingsModal").classList.remove("active")}function Q(){var e;const o=(e=document.querySelector('input[name="gridMode"]:checked'))==null?void 0:e.value,r=document.getElementById("gridUnitsSection");o==="custom"?r.style.display="flex":r.style.display="none"}function nt(o){m.customCols=o,F(),H()}function rt(o){m.customRows=o,X(),H()}function F(){const o=document.getElementById("gridUnitsSection");if(!o)return;o.querySelectorAll(".units-buttons")[0].querySelectorAll(".unit-btn").forEach(e=>{parseInt(e.textContent||"4")===m.customCols?e.classList.add("active"):e.classList.remove("active")})}function X(){const o=document.getElementById("gridUnitsSection");if(!o)return;o.querySelectorAll(".units-buttons")[1].querySelectorAll(".unit-btn").forEach(e=>{parseInt(e.textContent||"4")===m.customRows?e.classList.add("active"):e.classList.remove("active")})}function H(){const o=document.getElementById("gridResult");if(!o)return;const r=m.customCols||4,e=m.customRows||4,n=r*e;o.innerHTML=`<p>Grid: <strong>${r} columns × ${e} rows (${n} squares)</strong></p>`}let x=null;function st(){var e;const o=(e=document.querySelector('input[name="gridMode"]:checked'))==null?void 0:e.value;if(m.mode!==o){x={mode:o},it();return}Y(o)}function Y(o){m.mode=o,o==="simple"?(M(),T()):(R=m.customRows||4,S=m.customCols||4,M(),T()),J()}function it(){document.getElementById("confirmSaveModal").classList.add("active")}function lt(){document.getElementById("confirmSaveModal").classList.remove("active")}function at(o){o&&U(),x&&(Y(x.mode),x=null),lt()}window.updateColorPickers=j;window.addPatternToLibrary=Z;window.exportQuiltAsPNG=_;window.saveQuilt=U;window.loadQuilt=tt;window.openGridSettings=ot;window.closeGridSettings=J;window.updateGridMode=Q;window.setColumns=nt;window.setRows=rt;window.applyGridSettings=st;window.confirmSaveResponse=at;M();T();j();$();
